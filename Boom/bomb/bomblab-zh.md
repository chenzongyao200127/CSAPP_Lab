# 实验作业L2：解除二进制炸弹

## 1 简介
邪恶的Evil博士在我们班的机器上安放了一大堆“二进制炸弹”。二进制炸弹是一个由一系列阶段组成的程序。每个阶段都要求你在标准输入上输入一个特定的字符串。如果你输入正确的字符串，那么该阶段就被解除，炸弹就会进入下一个阶段。否则，炸弹就会爆炸，显示“BOOM!!!”然后终止。当每个阶段都被解除时，炸弹就被解除了。
炸弹太多了，我们无法一一处理，所以我们让每个学生解除一个炸弹。你的任务，你别无选择，只能在截止日期之前解除你的炸弹。祝你好运，欢迎加入排雷队！

### 步骤1：获取你的炸弹
你可以通过将你的网络浏览器指向以下地址来获得你的炸弹：
http://$Bomblab::SERVER_NAME:$Bomblab::REQUESTD_PORT/
这将显示一个二进制炸弹请求表单供你填写。输入你的用户名和电子邮件地址，然后点击提交按钮。服务器将会构建你的炸弹，并以名为bombk.tar的tar文件的形式返回到你的浏览器中，其中k是你的炸弹的唯一编号。
将bombk.tar文件保存到你计划进行工作的（受保护的）目录中。然后执行命令：tar -xvf bombk.tar。这将创建一个名为./bombk的目录，其中包含以下文件：
• README：标识炸弹及其所有者。
• bomb：可执行的二进制炸弹。
• bomb.c：包含Evil博士友好问候的炸弹主要程序源文件。
• writeup.{pdf,ps}：实验报告。
如果由于某种原因你请求了多个炸弹，这不是问题。选择一个炸弹来工作，并删除其余的。

### 步骤2：解除你的炸弹
这个实验室的任务是解除你的炸弹。
你必须在班级机器上完成作业。事实上，有传言说Evil博士真的很邪恶，如果在其他地方运行，炸弹总会爆炸。据我们所知，炸弹中还内置了几种其他的防篡改装置。
你可以使用许多工具来帮助你解除炸弹。请看提示部分以获取一些技巧和想法。*最好的方法是使用你最喜欢的调试器来逐步执行反汇编的二进制文件*。
每次你的炸弹爆炸时，它都会通知bomblab服务器，你在实验室最终得分中将失去1/2分（最多20分）。所以，炸弹爆炸是有后果的。你必须小心！
前四个阶段每个值10分。第5和第6阶段有点难度，所以它们各值15分。所以你能得到的最高分是70分。
虽然阶段难度逐渐增加，但你从一个阶段到另一个阶段获得的专业知识应该可以抵消这种困难。然而，最后一个阶段即使对最好的学生来说也是一个挑战，所以请不要等到最后一刻才开始。
如果炸弹以命令行参数运行，例如，
~~~shell
linux> ./bomb psol.txt
~~~
那么它将从psol.txt中读取输入行，直到到达EOF（文件结束x/），然后切换到标准输入。Evil博士在一个软弱的时刻添加了这个功能，所以你不必一直重复输入你已经解除的阶段的解决方案。
为了避免意外引爆炸弹，你需要学会如何单步执行汇编代码以及如何设置断点。你还需要学习如何检查寄存器和内存状态。做实验的一个好处是，你会非常擅长使用调试器。这是一个至关重要的技能，将在你的职业生涯中带来巨大的回报。

## 后勤
这是一个个人项目。所有的交付都是电子的。澄清和更正将在课程留言板上发布。

## 交付
没有明确的交付。当你在炸弹上工作时，炸弹会自动通知你的教师你的进展情况。你可以通过查看班级记分板来了解你的情况：
http://$Bomblab::SERVER_NAME:$Bomblab::REQUESTD_PORT/scoreboard
这个网页会不断更新，显示每个炸弹的进展情况。

## 提示（请阅读！）
有许多方法可以解除你的炸弹。你可以在不运行程序的情况下仔细检查它，并弄清楚它到底做了什么。这是一种有用的技术，但并不总是容易做到。你也可以在调试器下运行它，逐步观察它的操作，并使用这些信息来解除它。这可能是解除炸弹的最快方法。
我们有一个请求，请不要使用蛮力！你可以编写一个程序，尝试每一个可能的密钥来找到正确的一个。但这没有好几个原因：
`• 每次你猜错，炸弹爆炸，你就会失去1/2分（最多20分）。`
`• 每次你猜错，就会向bomblab服务器发送一条消息。你很快就会用这些消息饱和网络，并导致系统管理员撤销你的电脑访问权限。`
`• 我们没有告诉你字符串有多长，也没有告诉你它们包含什么字符。即使你做出了（错误的）假设，它们都不超过80个字符，只包含字母，那么你将为每个阶段猜测2680次。这将需要很长时间才能运行，而且在作业截止日期之前你不会得到答案。`
有许多工具被设计用来帮助你弄清楚程序是如何工作的，以及当它们不工作时出了什么问题。以下是一些你可能会在分析你的炸弹时发现有用的工具，以及如何使用它们的提示。

*• gdb*
GNU调试器，这是一个命令行调试器工具，几乎在每个平台上都可用。你可以逐行跟踪程序，检查内存和寄存器，查看源代码和汇编代码（我们没有为你的大部分炸弹提供源代码），设置断点，设置内存监视点，并编写脚本。
CS:APP网站
http://csapp.cs.cmu.edu/public/students.html
上有一个非常方便的单页gdb总结，你可以打印出来作为参考。以下是一些使用gdb的其他技巧。
- 为了防止每次输入错误的输入时炸弹就爆炸，你要学会如何设置断点。
- 要在线查看文档，请在gdb命令提示符下输入“help”，或者在Unix提示符下输入“man gdb”或“info gdb”。有些人也喜欢在emacs中运行gdb模式。

*• objdump -t*
这将打印出炸弹的符号表。符号表包括炸弹中所有函数和全局变量的名称，炸弹调用的所有函数的名称，以及它们的地址。通过查看函数名，你可能会学到一些东西！

*• objdump -d*
使用它来反汇编炸弹中的所有代码。你也可以只查看个别函数。阅读汇编代码可以告诉你炸弹是如何工作的。
虽然`objdump -d`给你提供了很多信息，但它并没有告诉你全部的故事。对系统级函数的调用显示得很神秘。例如，对sscanf的调用可能显示为：
~~~shell
8048c36: e8 99 fc ff ff call 80488d4 <_init+0x1a0>
~~~
要确定调用是sscanf，你需要在gdb中进行反汇编。

*• strings*
这个工具将显示你的炸弹中的可打印字符串。
正在寻找特定工具？文档怎么样？别忘了，apropos、man和info命令是你的朋友。特别是，man ascii可能会派上用场。info gas会告诉你关于GNU汇编器的更多信息，甚至可能是你想知道的。此外，网络也可能是信息的宝库。如果你感到困惑，请随时向你的教师求助。

